---
title: "Preference"
author: "jQuery404"
output: html_notebook
---


```{r}
library(ggplot2)
library(dplyr)
library(ggpubr)
library(gridExtra)
library(grid)
library(reshape2)

coloring = c("#E76469", "#F8D85E","#EDA645","#D1B0B3","#8C99A6","#ADD299","#4FA490","#3B7F9F")
fontsize = 14

preferences <- data.frame(
  Condition = c("H1", "H2", "H3", "H4"),
  R1 = c(2, 4, 1, 3), # Change these values to match the actual rankings in the study
  R2 = c(4, 3, 2, 1), # Change these values to match the actual rankings in the study
  R3 = c(3, 2, 4, 1), # Change these values to match the actual rankings in the study
  R4 = c(1, 2, 3, 4) # Change these values to match the actual rankings in the study
)

```


## Stacked bars within grouped barchart

```{r}
data=read.csv('csv/preference.csv', sep=",")

p <- ggplot(data, aes(x = conditions, y = score, fill = rank)) + 
  geom_bar(stat = 'identity', position = 'stack') + 
  coord_flip() +
  theme_bw()


p + facet_grid(rows = vars(qus),  switch = "y") + theme(strip.placement = "outside")
```

## Multiple Questions with 3 conditions rank

```{r}
data=read.csv('csv/preference.csv', sep=",")
qus_order <- c("Q1", "Q2", "Q3", "Q4","Q5","Q6")
rank_order <- c("Rank3", "Rank2", "Rank1")
coloring <- c("#4FA490", "#F8D85E","#E76469")
data$qus <- factor(data$qus, levels = qus_order)
data$rank <- factor(data$rank, levels = rank_order)
# "#E76469", "#F8D85E","#EDA645","#4FA490","#3B7F9F"

p <- ggplot(data, aes(x = conditions, y = score, fill = rank)) + 
  geom_bar(stat = 'identity', position = 'stack') + 
  coord_flip() +
  theme_bw()

# Add labels to bars
p <- p + geom_text(aes(label = score), position = position_stack(vjust = 0.5), color = "black", size = 4)

# Add facet grid
p <- p + facet_grid(vars(qus), switch = "y") + xlab("Preference questions") + ylab(NULL) + 
  theme(strip.placement = "outside",
        strip.background = element_rect(fill="#D9D9D9", color = '#464646'))

# Apply the custom colors to the fill color of each factor level
p <- p + scale_fill_manual(values = coloring, breaks = rev(rank_order))

# Add the significant differences
p <- p + geom_signif(data = subset(data, qus == "Q1"),
              comparisons = list(c("C1", "C3"), c("C2", "C3"), c("C1", "C2")), 
              annotations = c("ns", "**", "ns"), 
              y_position = c(35, 36.5, 38), 
              textsize = 4, tip_length = 0.01) 
p <- p + geom_signif(data = subset(data, qus == "Q3"),
              comparisons = list(c("C1", "C3"), c("C2", "C3")), 
              annotations = c("ns", "**"), 
              y_position = c(35, 36.5), 
              textsize = 4, tip_length = 0.01) 

# Add theme elements
p <- p + theme(axis.text.x = element_blank(),
               axis.text.y = element_text(face = "bold", color = "black"), 
               axis.ticks.x = element_blank(),
               plot.margin = unit(c(0, 0, .5, 0), "null"),
               panel.border = element_blank(),
               strip.text = element_text(face = "bold", color = "black"),
               legend.title=element_blank(),
               legend.direction="horizontal",
               legend.position = c(.5, -0.01),
               legend.justification = c("center", "top"))

# Show the plot
p

# saving the final figure
ggsave("out/preference.pdf", width = 7, height = 4, dpi = 1000)
```
## Rank plot for percondition with AR and VR



```{r}

data=read.csv('csv/preference.ar.vr.csv', sep=",")
condition_order <- c("C3", "C2", "C1")
qus_order <- c("Q1", "Q2", "Q3", "Q4","Q5","Q6")
rank_order <- c("Rank3", "Rank2", "Rank1")
coloring <- c("#4FA490", "#F8D85E","#E76469")
data$qus <- factor(data$qus, levels = qus_order)
data$rank <- factor(data$rank, levels = rank_order)
data$conditions <- factor(data$conditions, levels = condition_order)


cp <- function(data, title, leg_pos) {
  p <- ggplot(data, aes(x = role, y = score, fill = rank)) + 
  geom_bar(stat = 'identity', position = 'stack', width = 0.75) + 
  ggtitle(title) +
  coord_flip() +
  theme_bw()

# Add labels to bars
p <- p + geom_text(aes(label = ifelse(score != 0, score, "")), position = position_stack(vjust = 0.5), color = "black", size = 5)

# Add facet grid
p <- p + facet_grid(vars(conditions), switch = "y", scales = "free_x", space = "free_x") + ylab(NULL) + 
  theme(strip.placement = "outside",
        strip.background = element_rect(fill="#D9D9D9", color = '#464646'))

# Apply the custom colors to the fill color of each factor level
p <- p + scale_fill_manual(values = coloring, breaks = rev(rank_order)) 


# Add theme elements
p <- p + theme(
    plot.title = element_text(color = "black", size = 12, hjust = 0.5, margin = margin(b = 1)),
    plot.margin = margin(0, 0.25, 0.1, 0, unit = "cm"),
    strip.text.y = element_text(face = "bold", size = fontsize),
    strip.placement = "outside",
    axis.text.x = element_blank(),
    axis.text.y = element_text(color="black", size=fontsize),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text = element_text(size = fontsize),
    axis.ticks.x = element_blank(),
    legend.position = "none",
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_blank())

# Show the plot
p
}


df_q1 <- data[data$qus == 'Q1', ]
df_q2 <- data[data$qus == 'Q2', ]
df_q3 <- data[data$qus == 'Q3', ]
df_q4 <- data[data$qus == 'Q4', ]
df_q5 <- data[data$qus == 'Q5', ]

# Create boxplots
a <- cp(df_q1, "Q1.Which condition did you feel you\nwere more present in the remote space?", "none") + theme(
    plot.margin = margin(0, .5, 0.2, 0, unit = "cm"))
b <- cp(df_q2, "Q2.Which condition gave you the strongest \nsense of remote partners' presence?", "none") + theme(
    plot.margin = margin(0, .5, 0.2, 0, unit = "cm"))
c <- cp(df_q3, "Q3.Which condition did you find to be the \nmost fun to use?", "none") + theme(
    plot.margin = margin(0, .5, 0.2, 0, unit = "cm"))
d <- cp(df_q4, "Q4.Which condition best supported your \ncollaboration tasks?", "none") + theme(
    plot.margin = margin(0, .5, 0.2, 0, unit = "cm"))
e <- cp(df_q5, "\nQ5.Which condition did you prefer overall?", "none") + theme(
    plot.margin = margin(0, 0, 0.2, 0, unit = "cm"))

# 
final_plot <- grid.arrange(a, b, c, d, e, nrow = 1, ncol = 5)

# saving the final figure
ggsave("out/preference.pdf", final_plot, width = 19, height =3, dpi = 1000)


```





```{r}

# Create the data frame
df <- data.frame(
  x = c("a", "b"),
  y = c(1, 2, 3, 2, 3, 4)
)

# Create the bar chart
ggplot(df, aes(x, y)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.2), fill = "steelblue") +
  labs(x = "Group", y = "Values") +
  ggtitle("Bar Chart of a and b") +
  theme_minimal()




```

```{r}
data=read.csv('csv/preference.ar.vr.csv', sep=",")
qus_order <- c("Q1", "Q2", "Q3", "Q4","Q5","Q6")
rank_order <- c("Rank3", "Rank2", "Rank1")
coloring <- c("#E76469", "#F8D85E","#EDA645","#D1B0B3","#8C99A6","#ADD299","#4FA490","#3B7F9F")
data$qus <- factor(data$qus, levels = qus_order)
data$rank <- factor(data$rank, levels = rank_order)

cp <- function(df, title, leg_pos) {
# Create the ggplot object and specify data and aesthetics mapping
p <- ggplot(df, aes(x = role, y = score, fill = rank))

# Add the stacked bar chart layer
p <- p + geom_bar(stat = 'identity', position = 'stack') 

# Add text labels on the bars
p <- p + geom_text(aes(y = score, label = score),
                   position = position_stack(vjust = .5),
                   color = "black", size = 3)

p <- p + facet_grid(~ conditions, switch = "y")

# Apply the custom colors to the fill color of each factor level
p <- p + scale_fill_manual(values = coloring, breaks = rev(rank_order))

# Customize the chart appearance
p <- p + xlab("Category") + ylab("Value") + ggtitle(title) + theme_bw() + 
  theme(
    strip.placement = "outside",
    strip.background = element_rect(fill="#D9D9D9", color = '#464646'),
    strip.text.y.left = element_text(angle = 0),
    legend.position=leg_pos, 
    plot.title = element_text(size = 10),
    axis.line = element_blank(),
    axis.title.y=element_blank(),
    axis.title.x= element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank())
}

df_q1 <- data[data$qus == 'Q1', ]
df_q2 <- data[data$qus == 'Q2', ]
df_q3 <- data[data$qus == 'Q3', ]
df_q4 <- data[data$qus == 'Q4', ]
df_q5 <- data[data$qus == 'Q5', ]

# Create boxplots
a <- cp(df_q1, "Which system did you feel you were \nmore present in the remote space?", "none")
# b <- cp(df_q2, "Which system gave you the strongest \nsense of remote partners' presence?", "none")
# c <- cp(df_q3, "Which system did you find to be the \nmost fun to use?", "none")
# d <- cp(df_q4, "Which condition best supported your \ncollaboration tasks?", "none")
# e <- cp(df_q5, "Which system did you prefer overall?", "none")
a

# 
# final_plot <- grid.arrange(a, b, c, d, e, t, nrow = 2, ncol = 3)
# grid.arrange(final_plot)
# saving the final figure
ggsave("out/preference.pdf", final_plot, width = 8, height = 6, dpi = 1000)
```


## Preference breakdown based on Friedman + Kendall + Nemenyi test

```{r}
# Load necessary libraries
library(FSA)        # For the Nemenyi test
library(PMCMRplus)  # For the Nemenyi test

# Input data
scenario_A <- matrix(c(2, 1, 3, 4, 5,
                       1, 3, 5, 2, 4,
                       4, 5, 2, 1, 3),
                     nrow = 3, byrow = TRUE)

# Perform the Friedman test
friedman_result <- friedman.test(scenario_A)
print(friedman_result)

# Calculate Kendall's W
num_raters <- nrow(scenario_A)
num_objects <- ncol(scenario_A)
kendall_chi <- friedman_result$statistic / (sum(scenario_A)^2 - sum(scenario_A)^3 / (length(scenario_A) + 1))
print(kendall_chi)
kendall_w <- (12 * friedman_result$statistic) / (num_raters * num_objects * (num_objects + 1))
print(kendall_w)


# Convert matrix to long data frame format
scenario_A_long <- expand.grid(Rater = factor(1:nrow(scenario_A)), Object = factor(1:ncol(scenario_A)))
scenario_A_long$Rank <- as.vector(t(scenario_A))
# Perform post-hoc pairwise comparisons using the Nemenyi test
nemenyi_result <- frdAllPairsNemenyiTest(Rank ~ Object | Rater, data = scenario_A_long)
print(nemenyi_result)
```




## geom_signif

```{r}
#create data frame
df <- data.frame(team=rep(c('A', 'B', 'C'), each=3),
                 position=rep(c('Guard', 'Forward', 'Center'), times=3),
                 points=c(3, 2, 1, 1, 3, 2, 1, 2, 3))

ggplot(df, aes(fill=position, y=points, x=team)) + 
  geom_bar(position='stack', stat='identity') + 
  geom_signif(comparisons = list(c("B", "A"),
                                 c("B", "C"),
                                 c("C", "A")),
              test = "t.test", step_increase = 0.15, y_position= 6.1,
              map_signif_level = c("***", "**", "*")) +
  ylim(0, 7) +
  coord_flip()
```


## Save the resulting data frame as a CSV file

```{r}
write.csv(data, file = "out/data.csv", row.names = FALSE)
```

C3

```{r}
set.seed(123) # Set a random seed for reproducibility

# Generate 10 random numbers between -5 and 5
x <- runif(10, min = -5, max = 5)

# Subtract the median from each of these numbers to center the distribution around 0
x <- x - median(x)

# Scale the data to have a mean of 45 and adjust the spread of the data
x <- x * (45 / mean(x)) * (20 / 10)^0.5

# Shift the median of the data to 55
x <- x + 55

# Round each observation to the nearest multiple of 5
x <- round(x/5) * 5

# Remove any observations outside the range of 0 to 100
x <- x[x >= 0 & x <= 100]

# If necessary, add additional observations to reach a total of 20
while (length(x) < 20) {
  x <- c(x, round(runif(1, min = 0, max = 100)/5) * 5)
}

# Shuffle the vector to make the order of the observations random
x <- sample(x)

# View the resulting data set
x



```

C2

```{r}
set.seed(123) # Set a random seed for reproducibility

# Generate 10 random numbers between -15 and 15
x <- runif(10, min = -15, max = 15)

# Subtract the median from each of these numbers to center the distribution around 0
x <- x - median(x)

# Scale the data to have a mean of 35 and adjust the spread of the data
x <- x * (35 / mean(x)) * (20 / 10)^0.5

# Shift the median of the data to 50
x <- x + 50

# Round each observation to the nearest multiple of 5
x <- round(x/5) * 5

# Remove any observations outside the range of 0 to 100
x <- x[x >= 0 & x <= 100]

# If necessary, add additional observations to reach a total of 20
while (length(x) < 20) {
  x <- c(x, round(runif(1, min = 0, max = 100)/5) * 5)
}

# Shuffle the vector to make the order of the observations random
x <- sample(x)

# View the resulting data set
x


```

c3

```{r}
set.seed(123) # Set a random seed for reproducibility

# Generate 10 random numbers between -18 and 18
x <- runif(10, min = -18, max = 18)

# Subtract the median from each of these numbers to center the distribution around 0
x <- x - median(x)

# Scale the data to have a mean of 22 and adjust the spread of the data
x <- x * (22 / mean(x)) * (20 / 10)^0.5

# Shift the median of the data to 40
x <- x + 40

# Round each observation to the nearest multiple of 5
x <- round(x/5) * 5

# Remove any observations outside the range of 0 to 100
x <- x[x >= 0 & x <= 100]

# If necessary, add additional observations to reach a total of 20
while (length(x) < 20) {
  x <- c(x, round(runif(1, min = 0, max = 100)/5) * 5)
}

# Shuffle the vector to make the order of the observations random
x <- sample(x)

# View the resulting data set
x

```